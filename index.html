<!DOCTYPE html>
<html>
<head>
    <title>Genesys Client App - Alerting Demo</title>

    <link rel="stylesheet"
          href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet"
          href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">

    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script src="https://sdk-cdn.mypurecloud.com/client-apps/2.6.3/purecloud-client-app-sdk-de77761d.min.js"></script>

    <style>
        body { margin: 20px; }
        fieldset { margin-top: 30px; }
        .status span { font-weight: bold; }
    </style>
</head>

<body>

<h2>Genesys Client App – Runtime Status</h2>

<div class="alert alert-info status">
    <ul>
        <li>SDK: <span id="sdk">❌</span></li>
        <li>App Ready: <span id="ready">❌</span></li>
        <li>User: <span id="user">❌</span></li>
        <li>Alerting API: <span id="alerting">❌</span></li>
    </ul>
</div>

<hr>

<h2>Send a Toast</h2>

<form class="form-horizontal">
    <div class="form-group">
        <label class="col-sm-2 control-label">Title</label>
        <div class="col-sm-10">
            <input type="text" id="title" class="form-control">
        </div>
    </div>

    <div class="form-group">
        <label class="col-sm-2 control-label">Message</label>
        <div class="col-sm-10">
            <textarea id="message" rows="3" class="form-control"></textarea>
        </div>
    </div>

    <div class="form-group">
        <label class="col-sm-2 control-label">Type</label>
        <div class="col-sm-10">
            <select id="toastType" class="form-control">
                <option value="info">Info</option>
                <option value="success">Success</option>
                <option value="error">Error</option>
            </select>
        </div>
    </div>

    <div class="form-group">
        <div class="col-sm-offset-2 col-sm-10">
            <button class="btn btn-primary" id="sendToast">Send Toast</button>
        </div>
    </div>
</form>

<hr>

<h2>Attention Counter</h2>
<button class="btn btn-primary" id="incAttn">Increase</button>
<button class="btn btn-default" id="clearAttn">Clear</button>

<hr>

<h2>Open Window</h2>
<input type="text" id="targetURL" class="form-control"
       placeholder="https://en.wikipedia.org/wiki/Main_Page">
<br>
<button class="btn btn-primary" id="openWindow">Open Window</button>

<script>
$(function () {

    /* =====================================================
       1. Client App 초기화 (공식 예제 그대로)
       ===================================================== */
    let clientApp = null;

    const params = new URLSearchParams(window.location.search);

    if (params.get('gcHostOrigin') || params.get('gcTargetEnv')) {
        clientApp = new window.purecloud.apps.ClientApp({
            gcHostOriginQueryParam: 'gcHostOrigin',
            gcTargetEnvQueryParam: 'gcTargetEnv'
        });
    } else if (params.get('pcEnvironment')) {
        clientApp = new window.purecloud.apps.ClientApp({
            pcEnvironmentQueryParam: 'pcEnvironment'
        });
    } else {
        clientApp = new window.purecloud.apps.ClientApp();
    }

    $('#sdk').text('✅');

    /* =====================================================
       2. 인증 / 실행 컨텍스트 확인 (핵심)
       ===================================================== */
    clientApp.lifecycle.ready()
        .then(() => {
            $('#ready').text('✅');

            return clientApp.user.getMe();
        })
        .then(user => {
            $('#user').text(`✅ ${user.name}`);
            $('#alerting').text('✅');
            console.log('Logged-in user:', user);
        })
        .catch(err => {
            console.error('Client App initialization failed:', err);
        });

    /* =====================================================
       3. Toast
       ===================================================== */
    $('#sendToast').on('click', function (e) {
        e.preventDefault();

        clientApp.alerting.showToastPopup(
            $('#title').val(),
            $('#message').val(),
            { type: $('#toastType').val() }
        );
    });

    /* =====================================================
       4. Attention Counter
       ===================================================== */
    let count = 0;

    $('#incAttn').on('click', function () {
        count++;
        clientApp.alerting.setAttentionCount(count);
    });

    $('#clearAttn').on('click', function () {
        count = 0;
        clientApp.alerting.setAttentionCount(0);
    });

    /* =====================================================
       5. Open Window
       ===================================================== */
    $('#openWindow').on('click', function () {
        clientApp.coreUi.openWindow($('#targetURL').val());
    });

});
</script>

</body>
</html>
